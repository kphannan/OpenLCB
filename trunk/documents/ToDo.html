<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>NMRAnet To Do: Remaining Questions</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p5 {margin: 0.0px 0.0px 12.0px 75.0px; font: 12.0px Times}
    p.p6 {margin: 0.0px 0.0px 0.0px 75.0px; font: 12.0px Times}
    p.p7 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    span.s1 {text-decoration: underline}
    span.s2 {font: 10.0px Times}
    span.s3 {text-decoration: underline ; color: #0000f0}
    span.s4 {font: 12.0px Lucida Grande}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>To Do: Remaining Questions</b></h1>
<p class="p2">This page is a place to record issues that are still to be resolved. This is not a place for recording the discussion or decisions; once a decision is made, it should be implemented in the documents it affects. In particular, please don't make this a list of <span class="s1">answered</span> questions. The numbering is historical order; please delete an item that's done, not renumber below it, so SVN can track usage.</p>
<p class="p3">3. Settle question of terminology: "Wire Protocol" vs "Transport Mechanism", "Transport Layer Implementation", etc. E.g. do we stress protocol and wiring, or the transport/application layering? (See also item 14 below).</p>
<p class="p3">4. Where do we document how the proposal meets the use cases? (<i>This is a question about documentation; what document is the right place? I suggest in a 2</i><span class="s2"><i>nd</i></span> <i>part to the Use Case doc, so you can read the use cases by themselves, and then read the follow up discussion later on – Bob J</i>)</p>
<p class="p4"><br></p>
<p class="p3">8. Configuration process needs detail, both at line level (how to move data) and at the higher level. See <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/Configuration.html"><span class="s3">separate note.</span></a></p>
<p class="p4"><br></p>
<p class="p3">11. Add masking notification for events (for David Harris's desire to attach to ranges of Event ID as a defacto "Event plus data") This can be done with "mask low 0" and "mask low 1" forms.</p>
<p class="p3">12. Throttle: define initial protocol. See <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/LocomotiveControl.html"><span class="s3">separate document.</span></a></p>
<p class="p4"><br></p>
<p class="p3">13. Alex raised the issue of a "layout ID" so e.g. portable devices (WiFi throttles) can identify which of several layouts (e.g. at a show) should be joined. See <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/LayoutID.html"><span class="s3">working note</span></a>.</p>
<p class="p4"><br></p>
<p class="p3">14. MTI (Message Type Indicator) doesn't clarify the difference between "OpenLCB transport level" and "OpenLCB application level". Is the MTI (which needs to be renamed in any case) really a transport-specific field?</p>
<p class="p4"><br></p>
<p class="p3">15. NsnUniqueAssignment.html needs work for individual people. Will they be willing to use something like a phone number, or is this entire approach just invalid? Maybe they just have to get a number from the web site.</p>
<p class="p4"><br></p>
<p class="p3">17. Still need to think about "interface Event" conventions for e.g. large modular layouts. Via XML naming? Via EventID conventions? Goal is to link next-neighbor modules easily. <span class="s4"><br>
</span>Node and Event spaces for modular clubs? Let them allocate it! This might be a place for a router (which changes ID numbers) Write some examples. <span class="s4"><br>
</span><i>DPH: NIDa and Eventa can be allocated locally and be made globally unique by an appropriate prefix. I had thought use of masks might allow a flexible mechanism, that is well understood, to let different subnets (segments) have varying numbers of nodes and events.</i></p>
<p class="p2">18. Do we want to define a (small number) of “globally known” events that people can use if they want to? E.g. “power down” or “emergency stop”? (See lighting item 24 below) It's not clear what's gained by those for the layout. (item done)(item done) If we decide to do this, make it a separate note, and mention in overviews. How to get those in e.g. Blue/Gold configuration?</p>
<p class="p3">20. Write an XML-based representation, e.g. as a separate wire protocol for web services.</p>
<p class="p4"><br></p>
<p class="p2">21. Consider more detection and location things</p>
<ul>
  <ul>
    <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">(item done)</li>
    <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">(item done)</li>
    <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Smart Block Occupancy (Digitrax Transponding)</li>
  </ul>
</ul>
<p class="p5"><i>(DPH - I suspect there is a good unifying model that would pull this all together with the throttle stuff, but I do not know what it is. Perhaps defining (x,y,z) for every node, including Locos. Somehow dumb-BODs, smart-BODs, RF triangulation would all map to (x,y,z).)</i></p>
<p class="p2">22. Signaling (Signalling) – see <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/Signaling.html"><span class="s3">initial Signaling design note</span></a>. Needs work!</p>
<p class="p2">23. Layout Sound Control</p>
<ol>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Alex: (maybe just an adaptation to P/C Events but maybe should be identified at least) DPH: I think this is quite straight-forward. It includes complex nodes that can send and receive streams, or store the sounds, whether in real-time or not. The control of these should be straight-forward with events. Things like volume could use Events with data to set absolute levels, or increment and decrement Events. <i>(Need example doc for this application! - BobJ)</i></li>
</ol>
<p class="p2">24. Layout and Room Lighting Control DPH: Bob can probably fill us in on this one ;-) as he has some experience with X10 and JMRI. Do we need to do more than suggest some approaches? Maybe an application note, showing how it could be done? <i>(Define some recommended events for room intensity, e.g. how to code intensity in event space - BobJ)</i></p>
<p class="p2">25. Fast Clock DPH: Again, we only need to suggest some approaches. Bob had suggested EID= "&lt;ManuID/Model&gt;&lt;time-of-day-in-minutes:24&gt;" The fast-clock generates one message per fast-minute. Nodes that do simple things just respond to the time-Event of interest, eg "&lt;Alex/FastClock&gt;&lt;1PM&gt;". Other nodes might consume all of them to display a fast-clock, or a station-clock. Configuration would be manufacturer dependant. Need to include rate indication, so devices can extrapolate between events? Simpler in remote nodes than figuring it out from spacing. Also, need to know running vs stopped?</p>
<p class="p2">26. Streaming Media, specifically semi-real time delivery of content (not on CAN; see also 23)</p>
<ol>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Alex: Maybe this too is an adaptation of P/C Events for the control side with then triggers nodes to perform standard media streaming using other industry standard UDP/TCP/IP protocols etc) DPH: Yes. I think we need Streams on CAN -- one would want to be able to download a set of sounds to a sound-node, and then trigger them via Events. These streams would run in the background. You are talking about real-time streaming. I had sent another email about having different kinds of streams. So, I think we need to define those.</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Decision is <span class="s1">not</span> to include real-time streaming on CAN, due to difficulty of quality-of-service guarantees, but to attempt to include it on higher-bandwidth protocols, e.g. Ethernet, as needed. Not clear it is needed, though, as hardware with access to Ethernet has a lot of choices for e.g. streaming sound, video, etc.</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">In any case, document decisions, and (if needed) add a note.</li>
</ol>
<p class="p2">29. Make a careful estimate of the number of NID aliases (NIDas) needed for messages to a CAN segments from the outside world. There might be lots of nodes sending in unaddressed nodes from elsewhere. How much resources are needed to map those? Does this motivate an 'unmapped' value for NIDa? Or have a block of these used sequentially, with mapping known but not advertised, but you can ask for it before its reused?</p>
<p class="p2">35. Go through CAN bit assignments to make sure we have reserved 1 and 0 bits before and after MTI so that we have full flexibility later on. Add note about which reserved bits must not be checked (future use) and which are for future priority use, hence should not be checked.</p>
<p class="p2">37. Add a user-level introduction that talks about the user experience, and advantages to users. This is not quite the same thing as use cases, but those could be a starting point.</p>
<p class="p2">38. Turn the current introduction into a real geek-level document with a consistent organization.</p>
<p class="p2">41. Need to do a lot of work on cabling, connectors, etc at the CAN physical layer. Some things, like a built in terminator, should be “desirable but not required”; there's more than one way to do it (switch on board; ship a resistor in one of the CAN connectors on the board; etc) Can we reasonably <span class="s1">require</span> a cable implementation? Recommend one? Document one solution? Issue of power in a required implementation will be a contentious one.</p>
<p class="p2">43. The Consumer Identified and Producer Identified messages in CAN format carry flags that don't fit into the 8-byte data payload (as EventID is now the full 8 bytes), so have to go in header. This is mixing transport/data/application layer, and we need to put some real effort into getting it right.</p>
<p class="p2">44. Need to limit pileup on CAN network by throttling "responsive events"? e.g. wait 10 msec before sending things that happened in response to input?</p>
<ol>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times"><i>BobJ: This adds a lot of complexity, and I'm not sure it buys much. CAN is meant to deal with 100% bandwidth usage without loss of messages. Even defining what's meant by “wait 10 msec” isn't easy when multiple messages might be arriving close together, and some responses are due to things rapidly happening on the I/O side of a board. </i><span class="s4"><br>
</span><i>DPH: a global throttling-variable might be useful.</i></li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times"><i>BobJ: Whatever we decide, we should document this in numerology note; make standards-like statements in CAN protocol section.</i></li>
</ol>
<p class="p4"><br></p>
<p class="p3">45. Do we want to define some node-specific global events? E.g. “Node has logged error”, “Node has logged warning”; that in turn can e.g. trigger log retrieval. Others? Can define standard events as NodeID with low of 0xFFFF, etc.</p>
<p class="p4"><br></p>
<p class="p3">47. Eventually, write some words about common log format?</p>
<p class="p4"><br></p>
<p class="p3">48. Make a notional start on “train control”, e.g. throttles, etc. DCC, of course, but also allowing for other/future systems. Note that this is separate from e.g. connections to LocoNet, XpressNet, etc</p>
<p class="p4"><br></p>
<p class="p3">49. Re button configuration, Bob wrote in email:</p>
<p class="p3">When I consider a consumer or producer, I've been thinking of them as only knowing about <span class="s1">one</span> event. Instead of "a consumer can listen for 2 events and then do X in response", I was thinking in terms of "there are N consumers that listen for their event and do X". In that case, you don't have to worry about erasing/deleting/reprogramming a specific event in a producer or consumer; you deal with <span class="s1">the</span> event in the producer or consumer. Reading back through the docs, I see that we've talked about both approaches. For example, the <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/ProducerConsumerModel.html"><span class="s3">producer consumer note</span></a> uses the "one event per" model. The little boxes at the ends of the event arrows are individual producers and consumers. Other places, e.g. the <a href="file:///Users/dpharris/openlcb/trunk/documents/examples/BlueGoldConfig.html"><span class="s3">original Blue/Gold example</span></a> don't really make the distinction clearly. On the other hand, the XML DTD I proposed to the OpenLCB group a while back allowed you to put N events inside a "producer" or "consumer" element.</p>
<p class="p6">Action item here is to make a decision as to status of “one event per PorC, allow N PorCs” and/or “N events per PorC, only 1 PorC” models, and document as needed. Is this a basic architectural choice, e.g. part of a standard? Or just a conceptual convenience? Effects things like configuration, logging, etc, but not really the basic protocol; “Producer” and “Consumer” are not addressable objects in the current protocol.</p>
<p class="p4"><br></p>
<p class="p3">50. Redo priority order of CAN CIM/RIM messages (see alanheathrobinson email of 2009-08-11) so that the CIM sequence is in increasing priority order (give priority to completing some allocations); should we make RIM higher priority than CIM to get them done and announced?</p>
<p class="p3">51. If a CAN node receives a RIM with its alias during normal operation, in addition to going offline it should emit a “help me” frame that can be caught and logged. (Probably shouldn't resend in case of error, as collisions can happen in this case)</p>
<p class="p3">52. NodeId vs UniqueID terminology, esp. in the EventID allocation. Notional approach:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Define a space of 48-bit unique IDs. Operationally, this means changing the "allocating nodeIDs" document to refer to uniqueIDs, not nodeIDs, as the unit of allocation. Require that every OpenLCB node be given a unique 48-bit nodeID taken from an assigned set of uniqueIDs.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Require that every OpenLCB producer node be given a block of 64-bit event IDs such that the values in the most significant 48 bits of all those event IDs lie within an assigned set of 48-bit unique IDs, and none of those event IDs is assigned to more than one node.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Recommend, but don't require, that nodes start assigning EventIDs using the uniqueID they're using as their NodeID (most people don't need to look at EventID numbers, but being able to guess where they came from can be a useful debugging hint)</li>
</ul>
<p class="p4"><br></p>
<p class="p3">53. From the <a href="file:///Users/dpharris/openlcb/trunk/documents/StreamProtocol.html"><span class="s3">StreamProtocol</span></a> document: The best way to get the streaming CAN payload size, and hence the streaming bit efficiency up, is to get more into the CAN header. If we were to limit to only one stream between a given source and destination on a CAN link, hence not needing the stream ID byte, and if we were to use 12-bit node ID aliases instead of 16 (hence only 4095 accessible off-link node IDs instead of 64k), we could fit everything into a special format CAN header. That would give 8 byte payloads, and about a 50% bit efficiency for transfer. The format could be even more regular if we used 10-bit node aliases, leaving 9 bits for other info in the header (priority, type, a few MTI bits, etc). Large numbers of aliases are needed if (1) EventID filtering isn't used on off CAN-segment links and/or (2) the CAN link carries traffic between two off-CAN links, e.g. CAN is used as a central backbone instead of using IP for that.</p>
<p class="p4"><br></p>
<p class="p3">54. Need a boot-loader/IPL process definition. Also serves as a good streaming, datagram example.</p>
<p class="p4"><br></p>
<p class="p3">55. (from the can/index.html To Do list) Decide on CAN connector and cabling, as needed</p>
<p class="p4"><br></p>
<p class="p3">56. (from the can/index.html To Do list) Decide on CAN device termination requirements, as needed</p>
<p class="p4"><br></p>
<p class="p3">57. (from the can/index.html To Do list) Decide on CAN power/ground supply &amp; isolation requirements, as needed</p>
<p class="p4"><br></p>
<p class="p3">58. (from the can/index.html To Do list) Revisit CAN bit position and polarity assignments to ensure that priority is properly implied</p>
<p class="p4"><br></p>
<p class="p3">59. Datagram example: Small displays around the layout. Datagrams smaller than e.g. 4lines x 80characters, how to address that?</p>
<p class="p4"><br></p>
<p class="p3">60. Datagram support requires dedicated buffer (well, sort of requires it) for receipt in CAN nodes. That's a real limitation in RAM starved PIC nodes, or even basic Arduino nodes. Is 64 bytes reasonable? 32? 80?</p>
<p class="p4"><br></p>
<p class="p3">61. Need to redo MTI allocation. Aspects (which need to be documented!) are:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Code with a fixed bit to indicate only 8 (?) bits are significant, so that it sets into CAN OK</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Make it easy to separate addressed vs unaddressed, again for CAN</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Make it easy to separate out the stream payload (or other sort-of-addressed messages)</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Make it easy to separate out “must attend” messages for filtering</li>
</ul>
<p class="p4"><br></p>
<p class="p3">62.</p>
<p class="p4"><br></p>
<p class="p3">63.</p>
<p class="p4"><br></p>
<p class="p3">64.</p>
<p class="p4"><br></p>
<p class="p3">65.</p>
<p class="p4"><br></p>
<p class="p7"><br></p>
<p class="p2">This is SVN $Revision: 83 $</p>
</body>
</html>
