<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Example: Blue/Gold Configuration Protocol</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p5 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>Example: Blue/Gold Configuration Protocol</b></h1>
<p class="p2">Entry-level OpenLCB users should be able to buy two OpenLCB nodes and configure them to do something useful with only the pushbutton(s) and LED(s) on them, without requiring a separate configuration tool, computer, etc. One way to do that is presented here. It's not the only way, and there is no requirement for a standard in this area.</p>
<p class="p2">This method is based on easily creating a known-unique new Event ID. When Event IDs are much longer than Node ID numbers (NIDs), it's straightforward to do this by using the NID followed by a sequential number when a new unique Event ID is needed.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Default Producer</b></h2>
<p class="p2">Assume that a node can detect N conditions, each of which should send a unique P/C Event ID (the non-unique case is discussed below). The factory default condition is that each of those conditions will send a PCER message with a P/C Event ID of the board's unique NID followed by the input number (1, 2, etc). This is enough to get the board up and working.</p>
<p class="p2">For example, a board with 48-bit NID 0x123456789ABC would by default send Event ID 0x123456789ABC001 when its first input condition happened, 0x123456789ABC002 when its second input condition happened, etc. These Event IDs could then be counted on for no- or low-configuration use.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Configuring a Consumer</b></h2>
<p class="p2">Assume a node that can do N separate actions in response to PCER messages on the OpenLCB, where N is reasonably small.</p>
<p class="p2">The board has a blue button and associated LED.</p>
<p class="p2">To enter configuration mode, the button is pressed once. The LED starts periodically flashing once. While in this mode, the next PCER message received will be associated with the 1st action. Each additional button press moves on to the next higher-numbered action. The board exits capture mode after N+1 button presses, or upon being power-cycled.</p>
<p class="p2">The configuration sequence is then:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Quiesce the layout, or use a bench-top setup so you can control when messages are sent</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Press the blue button once, and confirm that the LED is now flashing once.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Force the event that should trigger action 1, e.g. by stimulating a producer board. The Event ID will be captured and configured when received.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Press the blue button once more, and confirm that the LED is now flashing twice.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Force the event that should trigger action 2, which will cause it to be captured.</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Repeat through all N actions</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Configuring An Event in Multiple Producers and Consumers</b></h2>
<p class="p2">One advantage of P/C is that it's easy to have multiple causes of an event, and multiple actions in response to that event. For example, the user might want two separate pushbuttons to set the turnouts at each end of a siding; that's implemented as two producers for a specific event (the two pushbuttons), and two consumers (the two turnout drivers).</p>
<p class="p2">Using the blue button to configure two consumers to action on a single P/C Event ID (PCER message) is straightforward: You just configure them like that using the sequence above.</p>
<p class="p2">Configuring two producers to use the same P/C Event ID uses the same ideas. The producer board has a gold (yellow) button and associated LED. To enter configuration mode, the gold button is pressed once. The LED starts to flash, indicating that the board is ready to configure input condition 1. The next PCER message's P/C Event ID will be captured so that the next time input condition 1 occurs, this new P/C Event ID will be sent.</p>
<p class="p2">The configuration sequence is then:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Quiesce the layout, or use a bench-top setup so you can control when messages are sent</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Press the gold button once, and confirm that the LED is now flashing once.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Force the event that should also be sent by condition 1, which will cause it to be captured.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Press the gold button once more, and confirm that the LED is now flashing twice.</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Force the event that should also be sent by condition 2, which will cause it to be captured.</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Repeat through all N actions</li>
</ul>
<p class="p5"><br></p>
<p class="p2">This is SVN $Revision: 52 $</p>
</body>
</html>
