<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>CAN/TCP/CAN/TCP Example</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.1  (Unix)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="David Harris">
	<META NAME="CHANGED" CONTENT="20091105;23504900">
	<!-- $Id: CAN-TCP-CAN-TCP-example.html 52 2009-09-04 04:22:37Z jacobsen $ -->
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>Example: CAN/TCP/CAN/TCP Communication</H1>
<P>Consider a OpenLCB installation with two CAN segments A and B
connected via gateways and a TCP/IP link. In addition, a program is
attached via a TCP/IP link and additional gateway to CAN segment B. 
</P>
<P>It's required that the program be able to fully communicate with
all NMRAnet nodes on both segments A and B. This example shows how
the gateways can do that. The first section is for &quot;transparent&quot;
gateways, that forward all traffic back and forth doing only the
necessary translation. The second section includes &quot;firewall&quot;
gateways, that only transfer needed traffic. 
<IMG SRC="../drawings/CAN-TCP-CAN-figure.gif" NAME="graphics1" ALIGN=BOTTOM WIDTH=400 HEIGHT=140 BORDER=0>
</P>
<P>For simplicity, we'll use the labels on the figure as if they were
the full NID of the node, e.g. &quot;GB1&quot; for the left gateway
on segment B. 
</P>
<H2>Transparent Case</H2>
<P>Both segments come up, assign the numbers 1,2,3 as aliases to
their local nodes, 10 to gateway 1 and 20 to gateway 2 on segment B.
Assume that all this happened before the links came up, so the
&quot;Initialization Complete&quot; messages didn't cross the TCP
links. 
</P>
<P>P wants to ensure B1 is reachable, so sends a packet with
&quot;P&quot;,&quot;Verify&quot;,&quot;B1&quot; to GB2. 
</P>
<P>GB2 assigns &quot;50&quot; as the local alias for P. Since this is
the first time that traffic from P/50 is being sent on the CAN
segment, GB2 sends &quot;50&quot;, &quot;Initialization Complete&quot;,
&quot;P&quot; and then sends &quot;50&quot;, &quot;Verify&quot;,&quot;B1&quot;
on CAN B. 
</P>
<P>GB1 notices that &quot;50&quot; now exists from the
&quot;Initialization Complete&quot;, marks it as locally present with
global NID &quot;P&quot;. It forwards the message to GA1 and CAN
segment A as &quot;P&quot;, &quot;Initialization Complete&quot;, &quot;P&quot;.
GA1 assigns a local alias of &quot;61&quot; and forwards a
&quot;61&quot;,&quot;Initialization Complete&quot;, &quot;P&quot;
message. Nothing reacts to that. 
</P>
<P>GB1 gets the Verify message, forwards it to GA1 and CAN segment A
as &quot;P&quot;, &quot;Verify&quot;, &quot;B1&quot; where it
transmitted but causes no reaction. 
</P>
<P>B1 sees the Verify message for &quot;B1&quot;, replies with a &quot;1&quot;,
&quot;Verified&quot;, &quot;B1&quot; 
</P>
<P>GB2 maps &quot;1&quot; back to &quot;B1&quot; and forwards the
message to P as &quot;B1&quot;, &quot;Verified&quot;, &quot;B1&quot; 
</P>
<P>P receives the Verified message, and has located B1. 
</P>
<P>GB1 sees the Verified message and updates its routing maps to
indicate that B1 is present on this segment if that's not already
known. It then forwards that to GA1, and hence on to CAN segment A. 
</P>
<P>P wants to ensure A2 is reachable, so sends a packet with
&quot;P&quot;,&quot;Verify&quot;,&quot;A2&quot; to GB2. 
</P>
<P>GB2 sends &quot;50&quot;, &quot;Verify&quot;,&quot;A2&quot; on CAN
B. 
</P>
<P>GB1 gets the Verify message, forwards it to GA1 as &quot;P&quot;,
&quot;Verify‚Äù, &quot;A2&quot;. (In this part of the example, P is
already known on segment A, so no &quot;Initialization Complete&quot;
is needed) 
</P>
<P>GA1 forwards the Verify message using the known alias for P: &quot;61&quot;,
&quot;Verify&quot;, &quot;A2&quot;. 
</P>
<P>A2 sees the Verify message for &quot;A2&quot;, replies with a &quot;2&quot;,
&quot;Verified&quot;, &quot;A2&quot; 
</P>
<P>GA1 maps &quot;2&quot; back to &quot;A2&quot; and forwards the
message to GB1 as &quot;A2&quot;, &quot;Verified&quot;, &quot;A2&quot;
</P>
<P>GB1 assigns &quot;51&quot; as the local alias for A2. Since this
is the first time that traffic from A2/51 is being sent on the CAN
segment, GB1 sends &quot;51&quot;, &quot;Initialization Complete&quot;,
&quot;A2&quot; and then sends &quot;51&quot;, &quot;Verified&quot;,
&quot;A2&quot; on CAN B. 
</P>
<P>GB2 sees the Initialization Complete and updates its routing
tables for A2. 
</P>
<P>GB2 sees the Verified message as coming from this link, so
translates it and sends it to P. 
</P>
<H2>Gated Case</H2>
<HR>
<P>This is SVN $Revision: 52 $ 
</P>
</BODY>
</HTML>