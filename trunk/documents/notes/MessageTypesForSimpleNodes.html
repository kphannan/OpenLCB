<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Note: Message Types for Simple Nodes</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p4 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times}
    p.p5 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times}
    p.p6 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>Note: Message Types for Simple Nodes</b></h1>
<p class="p2">The full OpenLCB protocol is complicated, because it has to enable complete discovery and routing into the future.</p>
<p class="p2">But simple nodes, e.g. a board on a CAN segment, only have to handle a subset of the full protocol. This note discusses that.</p>
<p class="p2">For the purposes of this note, we consider a "simple board" to:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Provide only one node</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Have a single CAN interface, and no other OpenLCB interfaces</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">To produce and consume events, but do nothing else with the OpenLCB</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times"><i>(What level of configuration?)</i></li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Initialization</b></h2>
<p class="p2">The simple board must take part in the CIM, RIM protocol to get a alias allocated.</p>
<p class="p2">Once that process is done, the simple board must send an "Initialization Complete" message.</p>
<p class="p2">It must follow that with "Producer Identified" and "Consumer Identified" messages for each of the events that it produces and consumes, respectively.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Monitoring</b></h2>
<p class="p2">The simple board must listen for "Verify Node ID Number" and "Verify Node ID Number" with its NID present. When found, the board needs to reply.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Events</b></h2>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Producing</b></h3>
<p class="p2">To produce an event, the simple board must send "Producer/Consumer Event Report" messages.</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Consuming</b></h3>
<p class="p2">To comsume an event, the simple board must listen for "Producer/Consumer Event Report" messages that match events its monitoring.</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Notification</b></h3>
<p class="p2">If the node produces or consumes events, it must listen for "Identify Producers" and "Identify Consumers" messages, respectively, with Event IDs that match its own internal Event IDs, and "Identify Events" messages that match its Node ID (NID).</p>
<p class="p2">If found, it must reply with it's own "Producer Identified" and "Consumer Identified" messages.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Summary: Bus Monitoring</b></h2>
<p class="p2">The simple board must listen for the following CAN frames, and respond to them. All others can be ignored, e.g. via CAN filters.</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">The CIM, RIM frames from node alias allocation</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Verify Node ID Number, Verify Node ID Number</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">If the simple board produces events, it must listen for "Identify Producers" and "Identify Events".</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">If the simple board consumes events, it must listen for "Producer/Consumer Event Report", "Identify Consumers" and "Identify Events".</li>
</ul>
<p class="p2">For a CAN node, at a minimum a board must receive and process two CIM, RIM segment specific messages, plus one (two if Addressed/Unaddressed is separately counted) common OpenLCB message. <i>Configuration process not included here</i></p>
<p class="p2">If the board can also produce and consume events, it has to receive and process four more message types.</p>
<p class="p2">Alternately, here are the messages a simple CAN board can ignore, perhaps via filtering:</p>
<ul>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Verified Node ID Number Number</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">The various error messages: Optional Interaction Rejected, Terminate Due to Error</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Consumer Identified, Consumer Identified, Producer Identified, Producer Identified</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Initialization Complete (But note that a node might want to monitor this to detect duplicate NIDs)</li>
</ul>
<p class="p6"><br></p>
<p class="p2">This is SVN $Revision: 52 $</p>
</body>
</html>
