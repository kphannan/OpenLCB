<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Note: Routing</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p6 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times}
    p.p7 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    span.s1 {text-decoration: underline ; color: #0000f0}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>Note: Routing</b></h1>
<p class="p2">OpenLCB is intended to be fully routable, in that any OpenLCB message should be able to get from any source node to any destination node.</p>
<p class="p2">This note discusses some aspects of that. (<i>There's a lot more in the </i><a href="file:///Users/dpharris/openlcb/trunk/documents/binary/index.html"><span class="s1"><i>Binary Wire Protocol</i></span></a><i> discussion, and much of that should be moved here</i>)</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Ranges</b></h2>
<p class="p4">Some devices might want to consume or produce a large number of Event IDs. For example, a real time or fast clock might advertise time as a range of EventIDs; a bridge to another network type (XpressNet, LocoNet, etc) might want to send a lot of events to represent net traffic, etc. These need to be routed, identified, etc. This could be done with numerous “Identify Consumer” and “Identify Producer” messages, but this would take a lot of them.</p>
<p class="p5"><br></p>
<p class="p4">Solving this is the purpose for the “Identify Produced Range” and “Identify Consumed Range” messages. They define a range of EventIDs using a mask on the lower order bits of the EventID. (This is not a general purpose mask or range system, to simplify the necessary routing algorithms; there are well-known algorithms for routing when a variable number of low-order bits have “don't care values”, as this is essentially the Internet routing problem)</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Loops</b></h2>
<p class="p2">Because multiple gateways can be connected to e.g. a single CAN segment, it's possible to create loops and other examples of multiple-path routing. These, in turn, can create multiple copies of OpenLCB messages unless gateways protect against this.</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Diagnostics</b></h3>
<p class="p2">Multi-path routing can cause packets to traverse a link in both directions, which in turn can be detected by storing a direction for each NID address being routed.</p>
<p class="p2">True loops, where a packet circulates around a series of links, can't be detected this way. They require e.g. a "steps taken" or "steps to live" field so that a gateway can detect that the same packet has reached the gateway with different values, hence via different routes. Or they can be detected (always? usually?) by detecting the same unique source Node ID coming from two different directions.</p>
<p class="p4">Unfortunately, OpenLCB CAN links don't have lots of space available to carry routing information. This implies that the verification needs to be done with special messages, either for testing routing, or as part of node initialization.</p>
<p class="p7"><br></p>
<p class="p2">This is SVN $Revision: 52 $</p>
</body>
</html>
