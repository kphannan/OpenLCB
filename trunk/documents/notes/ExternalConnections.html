<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Note: External Connections</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times}
    p.p4 {margin: 0.0px 0.0px 15.0px 0.0px; font: 19.0px Times}
    p.p5 {margin: 0.0px 0.0px 12.0px 0.0px; text-align: center; font: 12.0px Times}
    p.p6 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Lucida Grande}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p8 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    span.s1 {text-decoration: underline ; color: #0000f0}
    span.s2 {font: 10.0px Times}
    table.t1 {width: 767.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080}
    td.td1 {width: 85.0px; margin: 2.0px 2.0px 2.0px 2.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 8.0px 8.0px 8.0px 8.0px}
    td.td2 {width: 56.0px; margin: 2.0px 2.0px 2.0px 2.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 8.0px 8.0px 8.0px 8.0px}
    td.td3 {width: 382.0px; margin: 2.0px 2.0px 2.0px 2.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 8.0px 8.0px 8.0px 8.0px}
    td.td4 {width: 254.0px; margin: 2.0px 2.0px 2.0px 2.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 8.0px 8.0px 8.0px 8.0px}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>Note: External Connections</b></h1>
<p class="p2">OpenLCB adoption would be made more likely and faster if OpenLCB could interoperate with existing systems via external connections.</p>
<p class="p2"><i>(Should this move to separate docs at some point?)</i></p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>DCC</b></h2>
<p class="p2">OpenLCB should be able to control DCC accessory decoders (and eventually control stations?) ...</p>
<p class="p2">(See also <a href="file:///Users/dpharris/openlcb/trunk/documents/notes/UseWithDCC.html"><span class="s1">separate document</span></a> on this topic)</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>XPressNet</b></h2>
<p class="p2">S88 inputs?</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>LocoNet</b></h2>
<p class="p2">OpenLCB should be able to control devices via LocoNet and have LocoNet-attached devices create OpenLCB events. Layout occurances such as turnout throws, sensor changes, etc, should be mapped to and from OpenLCB P/C Event messages so they can be used without limitation.</p>
<p class="p2">A LocoNet is a limited resource, so large modular meets already use multiple interconnected LocoNets. The OpenLCB support should allow these to interoperate with OpenLCB devices, if not with each other, transparently.</p>
<p class="p2">Some messages could be carried via the low-order e.g. 4 or 6 bytes of events (routing would require “route range” support, not yet present), but some are long enough to require datagrams.</p>
<h2 style="margin: 0.0px 0.0px 15.0px 0.0px; font: 19.0px Times"><b>LocoNet Protocol Summary</b></h2>
<p class="p2">LocoNet uses variable-length messages, with the length encoded in the first byte as part of an op-code. The MSB is used to indicate message boundaries. The last byte of each message is a check byte.</p>
<p class="p2">The messages for controlling turnouts (accessory decoders) and sensors are four bytes long. LocoNet defines two separate address spaces for turnouts, and at least two for sensors. Throttle (DCC) control is done via a mix of four-byte and much longer messages.</p>
<p class="p2">LocoNet has provision for a one-byte “LocoNet ID” to separate multiple radio-operated LocoNets located close together. The vast majority of LocoNets use the default value, but modular layout groups are used to setting unique LocoNet IDs.</p>
<h2 style="margin: 0.0px 0.0px 15.0px 0.0px; font: 19.0px Times"><b>OpenLCB support</b></h2>
<p class="p2">LocoNet layout control messages effectively already are P/C events, in that they are broadcast to a set of unknown listeners. Mapping a set of these to and from unique EventIDs would make the connection to OpenLCB straightforward.</p>
<p class="p2">LocoNet EventID format:</p>
<table width="767.0" cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 0</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 6</b></p>
      </td>
      <td valign="top" class="td2">
        <p class="p5"><b>Byte 7</b></p>
      </td>
    </tr>
    <tr>
      <td colspan="4" valign="top" class="td3">
        <p class="p5">Unique ID</p>
      </td>
      <td valign="top" class="td1">
        <p class="p5">Loconet ID</p>
      </td>
      <td colspan="3" valign="top" class="td4">
        <p class="p5">LocoNet Message Content</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p6"><br>
</p>
<p class="p2">The unique ID is taken from (somebody's) assigned name space, so that it's guaranteed to remain unique. If there are ever multiple vendors of LocoNet gateways, they'd have separate Unique IDs.</p>
<p class="p2">Two ways of mapping LocoNet to and from OpenLCB have been proposed. In the “transformation” approach, the gateway parses incoming LocoNet messages to extract their type, device address, etc, and then this is used to form the message-specific content of the event.</p>
<p class="p2">Another approach, which simplifies the gateway code, is just send LocoNet messages as received. Short ones fit in a single OpenLCB event message. (To send a LocoNet packet on a LocoNet, the remote gateway has to look at the 1<span class="s2"><sup>st</sup></span> byte to decide how many bytes are present to send; the check byte isn't sent over OpenLCB)</p>
<p class="p2">For example, the LocoNet packet to throw turnout 12 is 0xB0 0x0B 0x10 0x54</p>
<p class="p2">The corresponding OpenLCB Event ID would be:</p>
<table width="767.0" cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 0</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="top" class="td1">
        <p class="p5"><b>Byte 6</b></p>
      </td>
      <td valign="top" class="td2">
        <p class="p5"><b>Byte 7</b></p>
      </td>
    </tr>
    <tr>
      <td colspan="4" valign="top" class="td3">
        <p class="p5">Unique ID</p>
      </td>
      <td valign="top" class="td1">
        <p class="p5">Loconet ID</p>
      </td>
      <td valign="top" class="td1">
        <p class="p5">0xB0</p>
      </td>
      <td valign="top" class="td1">
        <p class="p5">0x0B</p>
      </td>
      <td valign="top" class="td2">
        <p class="p5">0x10</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p6"><br>
</p>
<p class="p2">Any OpenLCB device wanting throw LocoNet turnout 12 or be notified when LocoNet turnout 12 has been thrown could just use this Event ID.</p>
<p class="p2">LocoNet messages longer than four bytes would be sent as multiple event messages. Since OpenLCB is a reliable ordered transport, the LocoNet MSB and length code in byte 4 of the first message is sufficient for reassembling a LocoNet message before transmitting it on the LocoNet link.</p>
<p class="p2">This approach has the advantage that it is completely transparent to changes and additions to the LocoNet protocol itself.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>C/MRI</b></h2>
<p class="p7">Input/output to C/MRI nodes via mapping of addresses...</p>
<p class="p8"><br></p>
<p class="p2">This is SVN $Revision: 52 $</p>
</body>
</html>
