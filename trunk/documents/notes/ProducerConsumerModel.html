<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE>On Using Producer/Consumer Events</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.0  (Win32)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGED" CONTENT="20090215;15203300">
	<META NAME="Info 1" CONTENT="">
	<META NAME="Info 2" CONTENT="">
	<META NAME="Info 3" CONTENT="">
	<META NAME="Info 4" CONTENT="">
	<STYLE TYPE="text/css">
	<!--
		TH P { margin-bottom: 0cm }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>On Using Producer/Consumer Events</H1>
<P>Simple example</P>
<P><A HREF="../drawings/SimplestPCExample.png"><IMG SRC="../drawings/SimplestPCExample.png" NAME="Simple Producer Consumer example" ALIGN=BOTTOM WIDTH=294 HEIGHT=146 BORDER=0></A>
</P>
<P>Events have the advantage that multiple devices (consumers) can
listen for the same one:</P>
<P><A HREF="../drawings/NConsumerExample.png"><IMG SRC="../drawings/NConsumerExample.png" NAME="graphics3" ALT="Multiple consumer example" ALIGN=BOTTOM WIDTH=290 HEIGHT=218 BORDER=0></A></P>
<P>The button doesn't have to be configured to talk to all the lamps,
the lamps are individually configured, and they don't even have to be
of the same type.</P>
<P>It's also possible for multiple producers to cause the same
actions by producing the same event:</P>
<P><A HREF="../drawings/NProducerExample.png"><IMG SRC="../drawings/NProducerExample.png" NAME="graphics2" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=290 HEIGHT=214 BORDER=0></A></P>
<P>None of the producers need to know about each other. A new one can
be added without reconfiguring anything.</P>
<P>Producers and consumers usually are grouped, e.g. with two
separate events for switch flipped either way or for output on/off.</P>
<P><A HREF="../drawings/OnOffExample.png"><IMG SRC="../drawings/OnOffExample.png" NAME="graphics1" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=284 HEIGHT=154 BORDER=0></A></P>
<P>In that example, normal operation has the bulb following the
on/off switch. The pushbutton can also command the light off at any
time.</P>
<P>Consumer multiplicity vs Producer multiplicity</P>
<P>System generalizes well to separate, overlapping selections...</P>
<P>Day/night/all-on/all-off example. Four events from N producers are
interpreted by 2*M consumers. Two events per consumer (either day or
night, and either on or off). Or teach producers to send two events,
e.g. &ldquo;on for on at night&rdquo; and &ldquo;on for on in
daytime&rdquo; to turn all on.</P>
<P><A HREF="../drawings/DayNightExample.png"><IMG SRC="../drawings/DayNightExample.png" NAME="graphics4" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=356 HEIGHT=260 BORDER=0></A></P>
<P><BR><BR>
</P>
<P><A HREF="../drawings/DayNightExample2.png"><IMG SRC="../drawings/DayNightExample2.png" NAME="graphics5" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=355 HEIGHT=246 BORDER=0></A></P>
<P>The situation gets more complicated when there are a large number
of devices and a large number of inputs that make arbitrary
combinations. Limiting case is N states and M outputs, where each of
the outputs has to be set for each of the inputs. Somewhere, the
mapping between those needs to be maintained. 
</P>
<H2>Compound yard throat example</H2>
<P><A HREF="../drawings/CompoundLadder.png"><IMG SRC="../drawings/CompoundLadder.png" NAME="graphics6" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=287 HEIGHT=198 BORDER=0></A></P>
<P>Each digit is a turnout which consumes events to set &ldquo;straight&rdquo;
and other events to set &ldquo;diverging&rdquo;. There are a total of
2*8 = 16 consumers. The letters are 9 pushbuttons that can produce
one or more events when pressed. The goal is to align the turnouts
for the pressed button.</P>
<P>One way to do this is to have the buttons send a single event,
which we'll label with the name of the button, and have turnouts be
able to receive all relevant events.</P>
<TABLE WIDTH=80% BORDER=1 CELLPADDING=4 CELLSPACING=3>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<COL WIDTH=28*>
	<TR VALIGN=TOP>
		<TH WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TH>
		<TH WIDTH=11% SDVAL="1" SDNUM="4105;">
			<P ALIGN=CENTER>1</P>
		</TH>
		<TH WIDTH=11% SDVAL="2" SDNUM="4105;">
			<P ALIGN=CENTER>2</P>
		</TH>
		<TH WIDTH=11% SDVAL="3" SDNUM="4105;">
			<P ALIGN=CENTER>3</P>
		</TH>
		<TH WIDTH=11% SDVAL="4" SDNUM="4105;">
			<P ALIGN=CENTER>4</P>
		</TH>
		<TH WIDTH=11% SDVAL="5" SDNUM="4105;">
			<P ALIGN=CENTER>5</P>
		</TH>
		<TH WIDTH=11% SDVAL="6" SDNUM="4105;">
			<P ALIGN=CENTER>6</P>
		</TH>
		<TH WIDTH=11% SDVAL="7" SDNUM="4105;">
			<P ALIGN=CENTER>7</P>
		</TH>
		<TH WIDTH=11% SDVAL="8" SDNUM="4105;">
			<P ALIGN=CENTER>8</P>
		</TH>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>A</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>B</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>C</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>E</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>F</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>G</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>H</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>I</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER>S</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=11%>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<P>Although this table looks complicated, the configuration can be
created manually using e.g. the blue/gold algorithm: Go to each
turnout along the route to a specific track, set it as required and
put it in acquisition mode, then press the button for that track.
Repeat for each track. This works so long as enough events can be
recognized by each consumer.</P>
<P>In the worst case, turnout 1 must receive and respond to every
event by either setting straight or diverging. (Look down column 1 to
see this) Five events must be recognized to set Turnout 1 straight.
Turnout 2 needs to respond to 5 total events, 2 for straight and 3
for diverging. The others need to respond to 1 or 2 for each of
straight and diverging.</P>
<P>In general, this approach will have a few turnouts at the start of
the throat that must respond to many events, with turnouts later on
needing to look for only a few events.</P>
<P>There's another approach available: Note that no event sets more
than four turnouts, and some set three. For this type of ladder,
having the producers send multiple events can be simpler. 
</P>
<P>For example, if we define 2*8 events as individual &ldquo;Set
Turnout 1 straight&rdquo;, Set Turnout 1 diverging&rdquo;, &ldquo;Set
Turnout 2 straight&rdquo;, etc, then each button producer needs to
send only three or four of these to set a route. This is very similar
to the usual method of using turnout commands, and has the same
drawback: All the buttons must be programmed in detail, and must be
able to send lots of commands.</P>
<P>The entire yard can be done with two-event producers and two-event
consumers using a combination of these. Define three events, called
i, ii and iii, which connect to tracks A,B,C; D,E; and F,G,H,I;
respectively. Each button sends one of these in addition to the usual
A though I events. The i-iii events are aimed at the start of the
throat, routing to groups of turnouts that can be handled with just
two consumers. See table below.</P>
<TABLE WIDTH=571 BORDER=1 CELLPADDING=4 CELLSPACING=3>
	<COL WIDTH=45>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=46>
	<COL WIDTH=42>
	<TR VALIGN=TOP>
		<TH WIDTH=45>
			<P ALIGN=CENTER><BR>
			</P>
		</TH>
		<TH WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TH>
		<TH WIDTH=46 SDVAL="1" SDNUM="4105;">
			<P ALIGN=CENTER>1</P>
		</TH>
		<TH WIDTH=46 SDVAL="2" SDNUM="4105;">
			<P ALIGN=CENTER>2</P>
		</TH>
		<TH WIDTH=46 SDVAL="3" SDNUM="4105;">
			<P ALIGN=CENTER>3</P>
		</TH>
		<TH WIDTH=46 SDVAL="4" SDNUM="4105;">
			<P ALIGN=CENTER>4</P>
		</TH>
		<TH WIDTH=46 SDVAL="5" SDNUM="4105;">
			<P ALIGN=CENTER>5</P>
		</TH>
		<TH WIDTH=46 SDVAL="6" SDNUM="4105;">
			<P ALIGN=CENTER>6</P>
		</TH>
		<TH WIDTH=46 SDVAL="7" SDNUM="4105;">
			<P ALIGN=CENTER>7</P>
		</TH>
		<TH WIDTH=42 SDVAL="8" SDNUM="4105;">
			<P ALIGN=CENTER>8</P>
		</TH>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>A</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>i, A</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (i,ii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (i)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (A)</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>B</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>i, B</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (i,ii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (i)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (B,C)</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER>s (B)</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>C</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>i, C</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (i,ii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (i)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (B,C)</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER>s (C)</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>D</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>ii, D</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (i)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (ii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (D)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>E</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>ii, E</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (i)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (ii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (E)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>F</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>iii, F</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d(iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d(F,G)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (F)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>G</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>iii, G</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d(F,G)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>H</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>iii, H</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s(iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (H)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=45>
			<P ALIGN=CENTER>I</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>iii, I</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>d (iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s (iii)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER>s(I)</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=46>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
		<TD WIDTH=42>
			<P ALIGN=CENTER><BR>
			</P>
		</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
<H3>Linear yard throat example</H3>
<P>Many yard throats are linear: To get to track M, you go through
M-1 turnouts set straight, and then finally one set diverging. 
</P>
<P>If using &ldquo;consumer multiplicity&rdquo;, where the track
buttons just create a single specific event for each of N tracks, all
of which turnouts listen to when required, the first turnout has to
listen for N-1 events that will set &ldquo;straight&rdquo;, and one
that will set &ldquo;diverging&rdquo;. For N large, the turnout might
not be able to listen for that many events in one state. A similar
approach can be used, where turnouts are assigned to groups, and
early turnouts just listen for a few group events. 
</P>
<P>Clearly, tools to do this configuration will be helpful.</P>
<H2>Application to Signals</H2>
<P>Signaling usually requires more logic than can be handled via raw
events, e.g. occupancy, look ahead, etc. But a head device could
listen to state via events. Need to still emit events for aspects so
that e.g. a control panel can mirror.</P>
<P>SE8c has cable (4 heads) as unit of multiplicity; vs single head
in a signal decoder; vs individual LEDs.</P>
<H3>Signals via single-lamp drivers</H3>
<P>You can connect the lamps of a signal head to individual
consumers:</P>
<P><A HREF="../drawings/SignalViaLamps.png"><IMG SRC="../drawings/SignalViaLamps.png" NAME="graphics7" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=226 HEIGHT=255 BORDER=0></A></P>
<P>This is a powerful but complicated approach. 
</P>
<H3>Signals via single-head drivers</H3>
<P><A HREF="../drawings/SignalViaHeads.png"><IMG SRC="../drawings/SignalViaHeads.png" NAME="graphics8" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=228 HEIGHT=158 BORDER=0></A></P>
<H3>Signals via mast drivers</H3>
<P><A HREF="../drawings/SignalViaMast.png"><IMG SRC="../drawings/SignalViaMast.png" NAME="graphics10" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=228 HEIGHT=194 BORDER=0></A></P>
<H3>Signals via control-point drivers</H3>
<P><A HREF="../drawings/SignalViaCP.png"><IMG SRC="../drawings/SignalViaCP.png" NAME="graphics9" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=230 HEIGHT=206 BORDER=0></A></P>
<H2>Integrated Signals</H2>
<P>In each of the examples above, the signal controller consumes
events that directly control the appearance of the signals. It's also
possible to build a signal controller that watches status events from
the railroad and makes independent decisions about signal states and
appearances.</P>
<P><A HREF="../drawings/SignalViaCPAuto.png"><IMG SRC="../drawings/SignalViaCPAuto.png" NAME="graphics11" ALT="Multiple producer example" ALIGN=BOTTOM WIDTH=230 HEIGHT=206 BORDER=0></A></P>
<H2>Internal vs External configuration</H2>
<P>How the events are stored and mapped to actions internally is not
something to be specified by NMRAnet. The configuration process just
defines which event(s) are assigned to which producer(s) and
consumer(s).</P>
<P>But it's important that implementation be possible, so in this
section we describe a few approaches.</P>
<P>Probably the hardest case is a single board that is controlling N
consumers or producers, e.g. N/2 devices, each of which has 2
consumers or producers for separate states, and each of which might
have to deal with up to M events. The worst case is then that the
board might have to store N*M events IDs and test whether each
incoming event report contains any of them. This kind of quadratic
growth can get out of control quickly.</P>
<P>In the yard example, we had 2*8 = 16 separate consumers. One
consumer needed to listen for 6 events, so if we round that up to 8,
if we wanted to create a general purpose 8-turnout controller without
limitations, one might imagine needing to store and compare (2*8)*8 =
128 event IDs.</P>
<P>Note that there were only 9 unique events, however. The total
number of <U>possible</U> settings of the yard throats isn't
relevant, because once an early turnout has ensured that a train
won't pass over some of the turnouts, their position doesn't matter.
For N turnouts, instead of 2^N possible unique events to set all
possible states of the throat, there are really only N+1.</P>
<P>This is an example of a set of events which set the state of a
number of outputs in an interconnected way. If there's sufficient
interconnection, and hence a reasonable number of events, the best
way to store it is a list of event IDs, each of which has associated
set of bits that determines the output states. Our 8 output board
might have 16 event slots, each of which has a byte to determine
which turnouts will be position and a byte to say whether it's
straight or diverging. Total storage, even with the growth from the 9
events events needed to the larger 16 events, is still 16*(8+2) = 160
bytes. Searching 16 events can be done linearly, but if not a simple
binary search (for unique event IDs) or tree search (for masked event
IDs) would speed it up.</P>
<P>At the other end of the spectrum, imagine N outputs consumers (N/2
devices with 2 consumers per device, or similar), each of which
responds to 1 to M events. Naively, you might assign space to store
N*M events, and have to ensure that all of those can be searched when
each event arrives. For example, 8 turnouts is 16 consumers, and if
you want to assign up 9 events to each (throat example above), you're
up to 64 events. Not all of these might be needed, however. A
controller might be limited to, say 32 total events. The compound
ladder example above uses 30. Some outputs use 1, some 2, up to 6;
that's not constrained, just the total. This could be implemented by
a sorted list, each entry of which points to the associated consumer.
Storage is small, searching can be done via a binary sort or tree,
and the list needs only to be reoptimized when the device is
reconfigured.</P>
<HR>
<P>This is SVN $Revision: 52 $ 
</P>
</BODY>
</HTML>