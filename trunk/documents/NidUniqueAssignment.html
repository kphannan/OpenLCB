<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Unique Node ID Assignment</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="824.48">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p4 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times}
    p.p5 {margin: 0.0px 0.0px 12.0px 0.0px; text-align: center; font: 12.0px Times}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p7 {margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Courier}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Courier; min-height: 14.0px}
    p.p10 {margin: 0.0px 0.0px 6.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    span.s1 {text-decoration: underline ; color: #0000f0}
    span.s2 {font: 12.0px Lucida Grande}
    table.t1 {border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080}
    td.td1 {width: 32.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
    td.td2 {width: 60.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
    td.td3 {width: 62.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
    td.td4 {width: 77.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
    td.td5 {width: 68.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
    td.td6 {width: 50.0px; margin: 1.0px 1.0px 1.0px 1.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 4.0px 4.0px 4.0px 4.0px}
  </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.0px 0.0px; font: 24.0px Times"><b>Unique Node ID Assignment</b></h1>
<p class="p2">The proposed OpenLCB depends on globally unique Node ID numbers (NIDs). This node discusses the assignment of those.</p>
<p class="p2">The "globally unique" requirement only refers to the universe of connected nodes; nodes that never need to communicate with each other need not have separate NIDs. In general, however, nodes can move: They can be sold or loaned for use on another layout, nodes on modular layouts can be connected to other arbitrary modules, and few assumptions can be made.</p>
<p class="p2">Unique IDs are assigned via a delegation process. At the highest level, the NMRA assigns ranges to people and organizations, within which they are responsible for assigning unique numbers to separate devices.</p>
<p class="p2">Anyone may request a block of IDs of a suitable size, which are then automatically assigned. It is preferred that this be an easy process, perhaps just filling out a web form, so that people can rapidly obtain and use unique IDs.</p>
<p class="p2">In addition to ranges directly assigned by the NMRA, there are several special-case populations of modules:</p>
<ol>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Numbers assigned by manufacturers</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Numbers assigned by members of organized groups</li>
  <li style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times">Numbers assigned by do-it-yourself hobbyists</li>
  <li style="margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times">Numbers assigned by software at run-time</li>
</ol>
<p class="p2">One of the reasons for having a long, 48-bit NID space is to make it easier to have alternative approaches like this. Particular assignments for these populations are discussed below. In each table, the blank bytes on the left (most significant bytes) will be assigned fixed values for distinguishing the various types.</p>
<p class="p2">In these delegated assignments, the lower order byte(s) are self-assigned. The values of zero is reserved, indicating that a number within the range hasn't been assigned.</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Numbers assigned by manufacturers</b></h3>
<p class="p3">As an initial simplification, and to encourage manufacturers to adopt OpenLCB, a group of 2^24 addresses will be assigned to each manufacturer with an NMRA manufacturer ID number.</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 6</b></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2">Mfg ID byte</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p2">The <a href="http://www.nmra.org/standards/DCC/mfgnumbers.html"><span class="s1">NMRA has defined</span></a> ID number 238 for future expansion with in the existing 8-bit ID space, but has not determined how to use it. When 238 is finally used to identify a new set of manufacturers, those manufacturers can be assigned OpenLCB ranges with a different set of high-order bits.</p>
<p class="p2">Software manufacturers who use software keys can generate the low-order 24 bits from some unique part of the software key. Hardware manufacturers need to ensure that resetting a device to “factory defaults” doesn't lose the self-assigned part of the Node ID, e.g. the serial number.</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Numbers assigned by members of organized groups</b></h3>
<p class="p2">MERG kit builders and others would like to assign their own numbers without going through a complicated process. They can be assigned number ranges that involve their member number in the organization. A range of 255 numbers per member is sufficient for hobby usage; after building that many, the hobbyist can get a larger assignment via the manufacturer mechanism. It's also convenient to give hobbyists a byte as their range.</p>
<p class="p3">Each organization is assigned a unique high-order two bytes. The organization member number is given 24 bits.</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 6</b></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p2">member number</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p2">member number</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p2">member number</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
    </tr>
  </tbody>
</table>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Numbers assigned by do-it-yourself hobbyists</b></h3>
<p class="p3">There's an NMRA DIY manufacturer number (13), but by defining a larger range we can provide enough bits to make collisions less likely. We therefore define a 24-bit range, which provides 16,777,216 values.</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 6</b></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p2">phone number</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p2">phone number</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p2">phone number</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p2">To reduce the probability of collisions, DIY builders are requested to use their international phone number as the start of the unique ID for the modules they build.</p>
<p class="p2"><i>DPH: An international phone number is at least 10 decimal digits - that won't fit into 24-bits. </i><span class="s2"><br>
</span>BobJ: Oops. 24 bits is 16x10^6, just past 7 digits. 32 bits is 4.29x10^9, not quite 10 digits. Ten digits is 35 bits, with 255 per individual is 43 bits, still only 3% of the total address space. That's probably still a good investment. Giving individuals only 127 or 63 addresses would consume less of the address space. The real question is probably: Do we need this? Will people be willing to put their phone numbers in their cards?</p>
<p class="p2"><i>DPH: Also, I would likely want a space with more that 256 entries, how would we assign that? Do we need a fifth method? Perhaps a more general method administered by a website, to assign 2^n entries? </i><span class="s2"><br>
</span>BobJ: See the part at the top about "Anyone may request a block of IDs ..."</p>
<h3 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times"><b>Numbers assigned by software at run-time</b></h3>
<p class="p2">Programs that act as one or more OpenLCB nodes need to associate unique NIDs with them. For licensed software, where a unique key can be associated with each instance of the program, this is easy: Use the manufacturer space defined above, and generate the lower bits of specific ID from the license key.</p>
<p class="p2">Free, open and unlicensed software can't use a license-key-based method. Unfortunately, the 48-bit address space is too small to use the IP-address-plus-signature GIDs that would otherwise make this a simple problem, or the even larger MAC-address-plus-signature GIDs.</p>
<p class="p3">If the computer has a global IP address (not part of one of the four non-global IP ranges), that can be used initially.</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p5"><b>Byte 1</b></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p5"><b>Byte 2</b></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p5"><b>Byte 3</b></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p5"><b>Byte 4</b></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p5"><b>Byte 5</b></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p5"><b>Byte 6</b></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p6"><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p2">IP number</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p2">IP number</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p2">IP number</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p2">IP number</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p2">self-assigned</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p3">Non-global IP addresses (see appendix) will require another algorithm. It may be as simple as requesting that the user get a number from one of the above spaces and provide it. If the software determines it has an internet connection, it could also request a unique allocation from a central source.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Appendix - Private IP Addresses</b></h2>
<p class="p3"><i>(There is much more information in a </i><a href="file:///Users/dpharris/openlcb/trunk/documents/notes/NetworkingBackground.html"><span class="s1"><i>separate background document</i></span></a><i>, and this information should be moved there – Bob)</i></p>
<p class="p6"><br></p>
<p class="p8">There are three ranges of IP addresses that are "private":</p>
<p class="p9"><br></p>
<p class="p8">10.0.0.0 - 10.255.255.255 (2^24 addresses)</p>
<p class="p8">172.16.0.0 - 172.31.255.255 (2^16 addresses)</p>
<p class="p8">192.168.0.0 - 192.168.255.255 (2^16 addresses)</p>
<p class="p9"><br></p>
<p class="p8">In addition, a range is reserved for the Windows<span class="Apple-converted-space"> </span></p>
<p class="p8">"Automatic Private IP Addressing" feature:</p>
<p class="p8">169.254.0.0 -169.254.255.255 (2^16 addresses)</p>
<p class="p9"><br></p>
<p class="p8">The A/B/C class system:</p>
<p class="p8">A has 0XXX,XXXX in 1st octet (0-127) and allocates 24-bit ranges</p>
<p class="p8">B has 10XX,XXXX in 1st octet (128-191) and allocates 16-bit ranges</p>
<p class="p8">C has 110X,XXXX in 1st octet (192-223) and allocates 8-bit ranges</p>
<p class="p8">D has 111X,XXXX in 1st octet (224-255) and is used for multicast, etc.</p>
<p class="p9"><br></p>
<p class="p8">But the regularity this defines is used for routing, something not needed in the much smaller OpenLCBs.</p>
<p class="p9"><br></p>
<p class="p8">EUI-48 addresses (used to be known as MAC addresses) are 46 bits (48, but two of them indicate global/local and other use).</p>
<p class="p10"><br></p>
<p class="p2">This is SVN $Revision: 73 $</p>
</body>
</html>
