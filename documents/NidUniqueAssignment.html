<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>Unique Node ID Assignment</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.1  (Unix)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="Bob Jacobsen">
	<META NAME="CHANGED" CONTENT="20090928;14263500">
	<!-- $Id$ -->
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>Unique Node ID Assignment</H1>
<P>The proposed NMRAnet depends on globally unique Node ID numbers
(NIDs). This node discusses the assignment of those. 
</P>
<P>The &quot;globally unique&quot; requirement only refers to the
universe of connected nodes; nodes that never need to communicate
with each other need not have separate NIDs. In general, however,
nodes can move: They can be sold or loaned for use on another layout,
nodes on modular layouts can be connected to other arbitrary modules,
and few assumptions can be made. 
</P>
<P>Unique IDs are assigned via a delegation process. At the highest
level, the NMRA assigns ranges to people and organizations, within
which they are responsible for assigning unique numbers to separate
devices. 
</P>
<P>Anyone may request a block of IDs of a suitable size, which are
then automatically assigned. It is preferred that this be an easy
process, perhaps just filling out a web form, so that people can
rapidly obtain and use unique IDs. 
</P>
<P>In addition to ranges directly assigned by the NMRA, there are
several special-case populations of modules: 
</P>
<OL>
	<LI><P STYLE="margin-bottom: 0cm">Numbers assigned by manufacturers 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Numbers assigned by members of
	organized groups 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Numbers assigned by do-it-yourself
	hobbyists 
	</P>
	<LI><P>Numbers assigned by software at run-time 
	</P>
</OL>
<P>One of the reasons for having a long, 48-bit NID space is to make
it easier to have alternative approaches like this. Particular
assignments for these populations are discussed below. In each table,
the blank bytes on the left (most significant bytes) will be assigned
fixed values for distinguishing the various types. 
</P>
<P>In these delegated assignments, the lower order byte(s) are
self-assigned. The values of zero is reserved, indicating that a
number within the range hasn't been assigned. 
</P>
<H3>Numbers assigned by manufacturers</H3>
<P STYLE="margin-bottom: 0cm">As an initial simplification, and to
encourage manufacturers to adopt NMRAnet, a group of 2^24 addresses
will be assigned to each manufacturer with an NMRA manufacturer ID
number. 
</P>
<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=2>
	<TR>
		<TH>
			<P>Byte 1</P>
		</TH>
		<TH>
			<P>Byte 2</P>
		</TH>
		<TH>
			<P>Byte 3</P>
		</TH>
		<TH>
			<P>Byte 4</P>
		</TH>
		<TH>
			<P>Byte 5</P>
		</TH>
		<TH>
			<P>Byte 6</P>
		</TH>
	</TR>
	<TR>
		<TD></TD>
		<TD></TD>
		<TD>
			<P>Mfg ID byte</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
	</TR>
</TABLE>
<P>The <A HREF="http://www.nmra.org/standards/DCC/mfgnumbers.html">NMRA
has defined</A> ID number 238 for future expansion with in the
existing 8-bit ID space, but has not determined how to use it. When
238 is finally used to identify a new set of manufacturers, those
manufacturers can be assigned NMRAnet ranges with a different set of
high-order bits. 
</P>
<P>Software manufacturers who use software keys can generate the
low-order 24 bits from some unique part of the software key. 
Hardware manufacturers need to ensure that resetting a device to
“factory defaults” doesn't lose the self-assigned part of the
Node ID, e.g. the serial number.</P>
<H3>Numbers assigned by members of organized groups</H3>
<P>MERG kit builders and others would like to assign their own
numbers without going through a complicated process. They can be
assigned number ranges that involve their member number in the
organization. A range of 255 numbers per member is sufficient for
hobby usage; after building that many, the hobbyist can get a larger
assignment via the manufacturer mechanism. It's also convenient to
give hobbyists a byte as their range. 
</P>
<P STYLE="margin-bottom: 0cm">Each organization is assigned a unique
high-order two bytes. The organization member number is given 24
bits. 
</P>
<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=2>
	<TR>
		<TH>
			<P>Byte 1</P>
		</TH>
		<TH>
			<P>Byte 2</P>
		</TH>
		<TH>
			<P>Byte 3</P>
		</TH>
		<TH>
			<P>Byte 4</P>
		</TH>
		<TH>
			<P>Byte 5</P>
		</TH>
		<TH>
			<P>Byte 6</P>
		</TH>
	</TR>
	<TR>
		<TD></TD>
		<TD></TD>
		<TD>
			<P>member number</P>
		</TD>
		<TD>
			<P>member number</P>
		</TD>
		<TD>
			<P>member number</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
	</TR>
</TABLE>
<H3>Numbers assigned by do-it-yourself hobbyists</H3>
<P STYLE="margin-bottom: 0cm">There's an NMRA DIY manufacturer number
(13), but by defining a larger range we can provide enough bits to
make collisions less likely. We therefore define a 24-bit range,
which provides 16,777,216 values. 
</P>
<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=2>
	<TR>
		<TH>
			<P>Byte 1</P>
		</TH>
		<TH>
			<P>Byte 2</P>
		</TH>
		<TH>
			<P>Byte 3</P>
		</TH>
		<TH>
			<P>Byte 4</P>
		</TH>
		<TH>
			<P>Byte 5</P>
		</TH>
		<TH>
			<P>Byte 6</P>
		</TH>
	</TR>
	<TR>
		<TD></TD>
		<TD></TD>
		<TD>
			<P>phone number</P>
		</TD>
		<TD>
			<P>phone number</P>
		</TD>
		<TD>
			<P>phone number</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
	</TR>
</TABLE>
<P>To reduce the probability of collisions, DIY builders are
requested to use their international phone number as the start of the
unique ID for the modules they build. 
</P>
<P><I>DPH: An international phone number is at least 10 decimal
digits - that won't fit into 24-bits. </I><BR>BobJ: Oops. 24 bits is
16x10^6, just past 7 digits. 32 bits is 4.29x10^9, not quite 10
digits. Ten digits is 35 bits, with 255 per individual is 43 bits,
still only 3% of the total address space. That's probably still a
good investment. Giving individuals only 127 or 63 addresses would
consume less of the address space. The real question is probably: Do
we need this? Will people be willing to put their phone numbers in
their cards? 
</P>
<P><I>DPH: Also, I would likely want a space with more that 256
entries, how would we assign that? Do we need a fifth method? Perhaps
a more general method administered by a website, to assign 2^n
entries? </I><BR>BobJ: See the part at the top about &quot;Anyone may
request a block of IDs ...&quot; 
</P>
<H3>Numbers assigned by software at run-time</H3>
<P>Programs that act as one or more NMRAnet nodes need to associate
unique NIDs with them. For licensed software, where a unique key can
be associated with each instance of the program, this is easy: Use
the manufacturer space defined above, and generate the lower bits of
specific ID from the license key. 
</P>
<P>Free, open and unlicensed software can't use a license-key-based
method. Unfortunately, the 48-bit address space is too small to use
the IP-address-plus-signature GIDs that would otherwise make this a
simple problem, or the even larger MAC-address-plus-signature GIDs.</P>
<P STYLE="margin-bottom: 0cm">If the computer has a global IP address
(not part of one of the four non-global IP ranges), that can be used
initially. 
</P>
<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=2>
	<TR>
		<TH>
			<P>Byte 1</P>
		</TH>
		<TH>
			<P>Byte 2</P>
		</TH>
		<TH>
			<P>Byte 3</P>
		</TH>
		<TH>
			<P>Byte 4</P>
		</TH>
		<TH>
			<P>Byte 5</P>
		</TH>
		<TH>
			<P>Byte 6</P>
		</TH>
	</TR>
	<TR>
		<TD></TD>
		<TD>
			<P>IP number</P>
		</TD>
		<TD>
			<P>IP number</P>
		</TD>
		<TD>
			<P>IP number</P>
		</TD>
		<TD>
			<P>IP number</P>
		</TD>
		<TD>
			<P>self-assigned</P>
		</TD>
	</TR>
</TABLE>
<P STYLE="margin-bottom: 0cm">Non-global IP addresses (see appendix)
will require another algorithm. It may be as simple as requesting
that the user get a number from one of the above spaces and provide
it. If the software determines it has an internet connection, it
could also request a unique allocation from a central source.  
</P>
<H2>Appendix - Private IP Addresses</H2>
<P STYLE="margin-bottom: 0cm"><I>(There is much more information in a
<A HREF="notes/NetworkingBackground.html">separate background
document</A>, and this information should be moved there – Bob)</I></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<PRE>There are three ranges of IP addresses that are &quot;private&quot;:

10.0.0.0 - 10.255.255.255 (2^24 addresses)
172.16.0.0 - 172.31.255.255 (2^16 addresses)
192.168.0.0 - 192.168.255.255 (2^16 addresses)

In addition, a range is reserved for the Windows 
&quot;Automatic Private IP Addressing&quot; feature:
169.254.0.0 -169.254.255.255 (2^16 addresses)

The A/B/C class system:
A has 0XXX,XXXX in 1st octet (0-127) and allocates 24-bit ranges
B has 10XX,XXXX in 1st octet (128-191) and allocates 16-bit ranges
C has 110X,XXXX in 1st octet (192-223) and allocates 8-bit ranges
D has 111X,XXXX in 1st octet (224-255) and is used for multicast, etc.

But the regularity this defines is used for routing, something not needed in the much smaller NMRAnets.

EUI-48 addresses (used to be known as MAC addresses) are 46 bits (48, but two of them indicate global/local and other use).</PRE>
<HR>
<P>This is SVN $Revision$ 
</P>
</BODY>
</HTML>