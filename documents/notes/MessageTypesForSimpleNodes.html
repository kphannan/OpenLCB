<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>Note: Message Types for Simple Nodes</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.1  (Unix)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="David Harris">
	<META NAME="CHANGED" CONTENT="20091108;20104100">
	<!-- $Id$ -->
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>Note: Message Types for Simple Nodes</H1>
<P>The full OpenLCB protocol is complicated, because it has to enable
complete discovery and routing into the future. 
</P>
<P>But simple nodes, e.g. a board on a CAN segment, only have to
handle a subset of the full protocol. This note discusses that. 
</P>
<P>For the purposes of this note, we consider a &quot;simple board&quot;
to: 
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Provide only one node 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Have a single CAN interface, and
	no other OpenLCB interfaces 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">To produce and consume events, but
	do nothing else with the OpenLCB 
	</P>
	<LI><P><I>(What level of configuration?)</I> 
	</P>
</UL>
<H2>Initialization</H2>
<P>The simple board must take part in the CIM, RIM protocol to get a
alias allocated. 
</P>
<P>Once that process is done, the simple board must send an
&quot;Initialization Complete&quot; message. 
</P>
<P>It must follow that with &quot;Producer Identified&quot; and
&quot;Consumer Identified&quot; messages for each of the events that
it produces and consumes, respectively. 
</P>
<H2>Monitoring</H2>
<P>The simple board must listen for &quot;Verify Node ID Number&quot;
and &quot;Verify Node ID Number&quot; with its NID present. When
found, the board needs to reply. 
</P>
<H2>Events</H2>
<H3>Producing</H3>
<P>To produce an event, the simple board must send &quot;Producer/Consumer
Event Report&quot; messages. 
</P>
<H3>Consuming</H3>
<P>To comsume an event, the simple board must listen for
&quot;Producer/Consumer Event Report&quot; messages that match events
its monitoring. 
</P>
<H3>Notification</H3>
<P>If the node produces or consumes events, it must listen for
&quot;Identify Producers&quot; and &quot;Identify Consumers&quot;
messages, respectively, with Event IDs that match its own internal
Event IDs, and &quot;Identify Events&quot; messages that match its
Node ID (NID). 
</P>
<P>If found, it must reply with it's own &quot;Producer Identified&quot;
and &quot;Consumer Identified&quot; messages. 
</P>
<H2>Summary: Bus Monitoring</H2>
<P>The simple board must listen for the following CAN frames, and
respond to them. All others can be ignored, e.g. via CAN filters. 
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">The CIM, RIM frames from node
	alias allocation 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Verify Node ID Number, Verify Node
	ID Number 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">If the simple board produces
	events, it must listen for &quot;Identify Producers&quot; and
	&quot;Identify Events&quot;. 
	</P>
	<LI><P>If the simple board consumes events, it must listen for
	&quot;Producer/Consumer Event Report&quot;, &quot;Identify
	Consumers&quot; and &quot;Identify Events&quot;. 
	</P>
</UL>
<P>For a CAN node, at a minimum a board must receive and process two
CIM, RIM segment specific messages, plus one (two if
Addressed/Unaddressed is separately counted) common OpenLCB message.
<I>Configuration process not included here</I> 
</P>
<P>If the board can also produce and consume events, it has to
receive and process four more message types. 
</P>
<P>Alternately, here are the messages a simple CAN board can ignore,
perhaps via filtering: 
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Verified Node ID Number Number 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">The various error messages:
	Optional Interaction Rejected, Terminate Due to Error 
	</P>
	<LI><P STYLE="margin-bottom: 0cm">Consumer Identified, Consumer
	Identified, Producer Identified, Producer Identified 
	</P>
	<LI><P>Initialization Complete (But note that a node might want to
	monitor this to detect duplicate NIDs) 
	</P>
</UL>
<HR>
<P>This is SVN $Revision$ 
</P>
</BODY>
</HTML>