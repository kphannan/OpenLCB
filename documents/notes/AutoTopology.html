<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>OpenLCB Note: Automatic Topology Configuration</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.1  (Unix)">
	<!-- $Id$ -->
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>OpenLCB Note: Automatic Topology Configuration</H1>

Modular clubs, and larger modular-meets need a way of configuring modules into a
cohesive whole that is time and effort efficient. This proposal 
suggests some approaches to this. Essentially, an organization would set some 
standards and define some standard Events to implement that standard. 

<p>
(See also the separate figure in a <a href="images/images/ATC2.pdf">PDF file</a>)

<p>
Each modular organization, eg NTrak, defines a protocol and a set of *fixed*
events representing edge-messages for intra-module communication. They would
also assign a range of "Module IDs" to clubs and individuals. So, I might be
assigned: (symbolically) NTrak.dpharris.xx, based on my membership number
(01.00.34.02.54.xx, say), where xx is my modules' numbers. 

<p>
In this proposal the module ID represents a virtual-node, and it can represent a
single NTrak module, or a set of NTrak modules, which comprise one or more nodes. 

<p>
In addition, the organization defines fixed events, eg:
<ul>
<li>0001 Start auto-topography configuration
<li>0002 Stop ATC
<li>0003 Track 1 East block is occupied
<li>0004 Track 1 East block is unoccupied
<li>0005 Track 1 East signal is stop
<li>0006 Track 1 East signal is caution
<li>0007 Track 1 East signal is proceed
<li>...
<li>001D Track 3 West block is occupied
<li>....
</ul>

<p>
Each NTrak module(s) would be required to implement these fixed events. This 
can be done with a dedicated node, possibly obtained from the organizing
committee, or implemented across a number of nodes, one at each end of teh
module(s), say. To ease set-up, a special configuration tool might be provided
that knows the event numbers, and can program the appropriate event slots in the
nodes. 

<p>
How it works: 

<p>
Consider two modules A and B.
<pre>
east signal ---> ======loco>== ============== > > <--- west-signal
</pre>

<p>
Option 1 - creating the layout by taking a loco for a spin: 

<p>
When a loco is transitions from module-A to module-B from west to east, module-
B will report east-block-occupied and east-signal-state events. In the case of 
my module, it would send: NTrak.dpharris.01.0003 and NTrak.dpharris.01.0005. 
Since, module-A knows the loco is present on it, and that it is exiting to the
east, it will be expecting to receive some events from its adjacent block. It
will insert these into into the appropriate event-slots: West-block-occupied and
West-signal-stop. In addition, it will learn the module-id of the adjacent
module, as it is embedded in the module-event#s. Similarly, when the loco
leaves module-A, module-B will learn about module-A. In addition, if a module
remembers the last protocol events it sees, then as soon as it becomes occupied,
it can insert these events into the appropriate event-slots. 

<p>
Option 2 - creating the layout centrally:

<p>
Each track has a one wire electrical bidirectional connection between modules. 
A central meet-network manager gathers all the module IDs, and then tells each
one in succession to report while it simultaneously activates each inter-module
line. It repeats this with each module in succession. In more detail, the
manager tells node-A to report. Node-A activates its Track 1 East intra-module
line and sends the associated East messages. The next node reports
'West-intra-module-line-activated' and fills its slots with node-A's events. 
This process quickly establishes the topology of the layout. The intra-module
messages can either be learned by the modules at this time, as the above, or the
network manager can set them explicitly at a later time. 

<p>
Discussion:

<p>
Advantages: 

<p>
This should speed up connecting modules. Additional central functions of a
'meet-network manager' could be to draw a scale plan of the layout, if
dimensions of each module is available in an electronic form , either from the
module-nodes or on separate media. 

<p>
Disadvantages: 

<p>
This requires some coordination, although not that much. Different
organizations, even down to the individual level can have differing standards
and protocols. This can be a good or bad thing. 

<p>
Comments: 

<p>
Can tumble-down be 
automatically configured, if the appropriate nodes are told to do tumble-down? 
Similarly, a module that goes from a single to double track via a turnout could 
manage its assignments based on the setting of its turnout. 

<p>
Note the nodes in these modules still have their own node IDs and events. 

<HR>
<P>This is SVN $Revision$ 
</P>
</BODY>
</HTML>