<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>OpenLCB Note: Locomotive Control</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 3.2  (Unix)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="Bob Jacobsen">
	<META NAME="CHANGED" CONTENT="20100530;23544500">
	<META NAME="Info 1" CONTENT="">
	<META NAME="Info 2" CONTENT="">
	<META NAME="Info 3" CONTENT="">
	<META NAME="Info 4" CONTENT="">
	<META NAME="CHANGEDBY" CONTENT="David Harris">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>OpenLCB Note: Locomotive Control</H1>
<P>Locomotive control is traditionally the domain of DCC in the NMRA.
OpenLCB will likely need to eventually take part, and this note is a
place to put some of the discussion now taking place.</P>
<H2>Environment of Proposal</H2>
<H3>Requirements</H3>
<P STYLE="margin-bottom: 0cm">Self contained</P>
<P STYLE="margin-bottom: 0cm">Updatable</P>
<P STYLE="margin-bottom: 0cm">More then one type of configuration
device, separately implementatable</P>
<H3>Preferences</H3>
<H3>Design Points</H3>
<P>Use XML as a lingua franca.</P>
<P>Nodes may have little compute power; mustn't need to
compress/decompress on the fly.</P>
<P>“The map is not the territory” in configuration information.</P>
<H2>Discussion</H2>
<P>“All OpenLCB nodes will contain a compressed XML document that
contains all the relevant information for an external Configuration
Tool (CT) to be able to to use to know how to configure the node. It
is expected that the CT will use the data in the XML file to render
some form of suitable Graphical User Interface to allow the user to
easily and intuitively configure all aspects of the node's
capabilities. An important design choice was to embed this XML
document into each node so that the system has all it needs to
configure the node without having to source the XML file externally
to the OpenLCB from the manufacturer or some other on-line repository
via the Internet or a CD/DVD etc. While the CT is likely to be a
program running on a PC, it could be a hand-held device like mobile
phone or PDA or even a custom built CT.”</P>
<P><BR><BR>
</P>
<P>Items from To Do list, needing sorting and formatting:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Handling throttle off from one
	command station / booster to another.</P>
	<LI><P STYLE="margin-bottom: 0cm">A throttle attached to any segment
	should be able to control a train anywhere. 
	</P>
	<LI><P>It should be possible to hand a running train off from one
	throttle to another.</P>
	<LI><P>Throttles could be either a physical handheld or computer
	program.</P>
	<LI><P>What is the unit of addressability? A “locomotive”, a
	“decoder”, a “consist” or what?</P>
</UL>
<P STYLE="margin-left: 2cm">Clearly, we need to start writing some
thottle documents, just to make sure capabilities are in place.</P>
<P STYLE="margin-left: 2cm">Alex, via email: Although explicitly
excluded from our initial work I think we should have some place
holders for this at a high level. Needs to include: - DCC - DC -
Multi-Block DC (MERG SuperBloc, QuadThrottleUnit etc) - Wireless
direct to Locos - Other?</P>
<P STYLE="margin-left: 2cm">DPH: Yes, I started to list
possibilities, but they seem endless: (1) One block/one CS/ one
booster: DC, DCC, PWM DC (2) Multi- block/CS/booster (3) direct RF
control Perhaps our model should look like Throttle &lt;---&gt; Loco.
Whether that is really: (a) Throttle-RF &lt;--&gt; RF-receiver &lt;--&gt;
CS-service &lt;--&gt; aBooster ---&gt; Track --&gt; Loco-decoder
&lt;---&gt; BOD &lt;---&gt; Throttle or just: (b) Throttle-RF &lt;--&gt;
Loco-RF-decoder ; GPS&lt;--&gt;Throttle All the in-between bits are
hidden from the user - but not unfortunately, from us. 
</P>
<UL>
	<LI><P>Clearly, need to have a larger document to hold some
	discussion on this</P>
</UL>
<P><BR><BR>
</P>
<H2>Email Threads</H2>
<P>From DPH May 24, 2010:</P>
<P>OpenLCB Train Messaging</P>
<P>1. Messages are between a throttle and a train. In the future
messages will likely be send directly from throttle to train, via RF.
It is the job of  today's CS, perhaps with the help of a helper-node,
to model a train as a fully functioning pseudo-node. Messaging will
use directed messages, or Datagrams, but, could use bidirectional
streams. This interchange is really between the throttle and the CS,
but conceptually and in appearance to the user, it should appear to
be between the throttle and the train. 
</P>
<P>2. In large layouts with more than one command station (CS), each
CS will have a defined territory and associated DCC stream. When a
train crosses two territories, there must be automatic hand-off of
the train from one CS to the next. An block-occupation event will
announce a train 'crossing the frontier'. The receiving CS will
negotiate with the first for the train's NID, direction, speed,
acceleration, functional state, etc.</P>
<P>3. Two CSs cannot drive the same block, nor two adjacent blocks
with an engine bridging them, with their differing DCC streams. This
requires a special intervening block between the two CSs'
territories, which is switched between the two DCC streams. To
prevent more than one train entering the shared block, signaling and
speed control is used. This may fail with the simultaneous arrival of
two trains, and two additional short, protective, blocks may be
necessary to this. These can use 'Bit-switch'-like techniques to halt
oncoming trains.</P>
<P>4. Despite the train's movement, its NID is fixed, just like any
node. Each engine can be assigned a unique 48-bit NID by its
manufacturer, a user, or perhaps constructed from a RFID tag number.
Using the user's space would allow the lower 16-bits to equal the
engine's road number, which would simplify display without
translation tables. 
</P>
<P>5. Each train also has a NID. This can be assigned from the lead
engines NID, but it would be nice if the bottom digits represented
the train number as some of these have historical significance.
Therefore, the NID prefix could be derived from the layout ID, the
meet's range, or a fixed number denoting 'Train'. Train NIDs would
then have the form TRAIN.x, where x is 0-65k, and TRAIN is a fixed
48-bit number.</P>
<P>6. Just as a train moves around the layout, so can a throttle. It
can move between OpenLCB segments, but this should be easily handled
since the throttle has intelligence, two-way communication, and can
help to negotiate the move. OpenLCB's interest-based routing will may
play an important role in both throttle and train movement. 
</P>
<P>7. Ideally, command stations will handle the above. Until this
occurs, <FONT COLOR="#000000"><FONT FACE="Helvetica, sans-serif"><FONT SIZE=2 STYLE="font-size: 11pt">specific
nodes can supplement the present CSs. </FONT></FONT></FONT>
</P>
<P><BR><BR>
</P>
<HR>
<P>This is SVN $Revision$ 
</P>
</BODY>
</HTML>